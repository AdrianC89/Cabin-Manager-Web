<%- include("templates/header", {tituloWeb: 'Inicio de Sesión'}) %>

<div class="login-container">
    <div class="login-card">
        <div class="text-center mb-4">
            <img src="../images/LogoCabin.png" alt="Logo" width="100">
            <h2 class="mt-3">Cabin Manager</h2>
        </div>
        <form id="loginForm">
            <div class="mb-3">
                <label for="email" class="form-label">Correo Electrónico</label>
                <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-user"></i></span>
                    <input type="email" class="form-control" id="email" name="email" placeholder="Ingresa tu correo electrónico" required>
                </div>
            </div>
            <div class="mb-3">
                <label for="password" class="form-label">Contraseña</label>
                <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-lock"></i></span>
                    <input type="password" class="form-control" id="password" name="password" placeholder="Ingresa tu contraseña" required>
                    <span class="input-group-text toggle-password"><i class="fas fa-eye"></i></span>
                </div>
            </div>
            <div class="d-grid gap-2">
                <button type="submit" class="btn btn-primary" id="inicio">Iniciar Sesión</button>
            </div>
            <div class="mt-3 text-center">
                <a href="#">¿Olvidaste tu contraseña?</a>
            </div>
            <div class="mt-3 text-center">
                <p>¿No tienes una cuenta? <a href="/register">Regístrate aquí</a></p>
            </div>
        </form>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    $(document).ready(function() {
        $('.toggle-password').click(function() {
            $(this).find('i').toggleClass('fa-eye fa-eye-slash');
            let input = $(this).siblings('input');
            if (input.attr('type') === 'password') {
                input.attr('type', 'text');
            } else {
                input.attr('type', 'password');
            }
        });

        // Manejo del formulario de login con AJAX
        $('#loginForm').on('submit', function(event) {
            event.preventDefault(); // Evita el envío tradicional del formulario
            const formData = $(this).serialize(); // Serializa el formulario

            $.ajax({
                url: '/login',
                type: 'POST',
                data: formData,
                success: function(response) {
                    Swal.fire({
                        icon: 'success',
                        title: '¡Inicio de sesión exitoso!',
                        text: response.success,
                        showConfirmButton: false,
                        timer: 1500
                    }).then(() => {
                        window.location.href = '/admin'; // Redirige a la vista de administración
                    });
                },
                error: function(xhr) {
                    const errorMsg = xhr.responseJSON && xhr.responseJSON.error ? xhr.responseJSON.error : 'Ocurrió un error inesperado';
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: errorMsg
                    });
                }
            });
        });
    });
</script>

<%- include("templates/footer") %>

<div class="container mt-5">
    <!-- Formulario de búsqueda -->
    <form class="d-flex navbar-nav-center" role="search">
        <input class="form-control me-2" type="search" placeholder="Buscar" aria-label="Search">
        <button class="btn btn-outline-success" type="submit">Buscar</button>
    </form>

    <h1 class="mb-4">
        <%= titulo %>
    </h1>

    <table class="table table-striped table-bordered">
        <thead class="thead-dark">
            <tr>
                <% encabezados.forEach(encabezado=> { %>
                    <th>
                        <%= encabezado %>
                    </th>
                    <% }) %>
                        <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            <% datos.forEach(dato=> { %>
                <tr>
                    <% for (let key in dato) { %>
                        <td>
                            <%= dato[key] %>
                        </td>
                        <% } %>
                            <td>
                                <!-- Botón de Editar con datos -->
                                <button class="btn btn-primary btn-sm" data-bs-toggle="modal"
                                    data-bs-target="#editModal" data-id="<%= dato[idField] %>"
                                    data-info='<%= JSON.stringify(dato) %>'
                                    data-encabezados='<%= JSON.stringify(encabezados) %>'>
                                    <i class="fa-duotone fa-solid fa-edit"></i>
                                </button>

                                <!-- Botón de Eliminar con confirmación -->
                                <button class="btn btn-danger btn-sm" data-bs-toggle="modal"
                                    data-bs-target="#confirmationModal" data-id="<%= dato[idField] %>">
                                    <i class="fa-duotone fa-solid fa-trash"></i>
                                </button>
                            </td>
                </tr>
                <% }) %>
        </tbody>
    </table>
</div>
<!-- Modal de Edición -->
<div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editModalLabel">Editar Registro</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="editForm">
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" id="saveEditButton">Guardar cambios</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Confirmación Eliminar-->
<div class="modal fade" id="confirmationModal" tabindex="-1" aria-labelledby="confirmationModalLabel"
    aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmationModalLabel">Confirmación de Eliminación</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                ¿Estás seguro de que quieres eliminar este registro?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteButton">Eliminar</button>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        var confirmationModal = document.getElementById('confirmationModal');
        var confirmDeleteButton = document.getElementById('confirmDeleteButton');
        var editModal = document.getElementById('editModal');
        var editForm = document.getElementById('editForm');
        var saveEditButton = document.getElementById('saveEditButton');
        var recordId = null;
        var recordData = null;
        var entity = '<%= entidad %>'; // Obtener la entidad actual (por ejemplo, 'cabanas', 'clientes', 'reservas')

        // Manejo del modal de edición
    editModal.addEventListener('show.bs.modal', function(event) {
        var button = event.relatedTarget;
        recordId = button.getAttribute('data-id');
        recordData = JSON.parse(button.getAttribute('data-info'));
        var encabezados = JSON.parse(button.getAttribute('data-encabezados'));

        // Limpiar el formulario antes de agregar nuevos campos
        editForm.innerHTML = '';

        // Generar dinámicamente los campos y labels en base a los encabezados y datos
        encabezados.forEach(function(encabezado, index) {
            var key = Object.keys(recordData)[index];

            // Crear un div form-group para cada campo
            var formGroup = document.createElement('div');
            formGroup.className = 'mb-3';

            // Crear y agregar el label
            var label = document.createElement('label');
            label.className = 'form-label';
            label.textContent = encabezado;  // Usar el encabezado como label
            label.setAttribute('for', key);
            formGroup.appendChild(label);

            // Crear y agregar el input
            var input = document.createElement('input');
            input.className = 'form-control';
            input.setAttribute('type', 'text');
            input.setAttribute('name', key);
            input.setAttribute('id', key);
            input.value = recordData[key]; // Asignar el valor actual al input
            formGroup.appendChild(input);

            // Agregar el form-group al formulario
            editForm.appendChild(formGroup);
        });
    });

    saveEditButton.addEventListener('click', function() {
        var formData = new FormData(editForm);
        var endpoint = `/${entity}/${recordId}/edit`; 

        fetch(endpoint, {
            method: 'POST',
            body: formData
        }).then(response => {
            if (response.ok) {
                window.location.reload(); // Recargar la página para ver los cambios
            } else {
                alert('Hubo un error al guardar los cambios.');
            }
        }).catch(error => {
            console.error('Error:', error);
            alert('Hubo un error al procesar la solicitud.');
        });
    });
    confirmationModal.addEventListener('show.bs.modal', function (event) {
            // Retrieve data-id attribute from the button that triggered the modal
            var button = event.relatedTarget;
            var id = button.getAttribute('data-id');
            // Store the id in the confirmDeleteButton
            confirmDeleteButton.setAttribute('data-id', id);
        });

        confirmDeleteButton.addEventListener('click', function () {
            var id = this.getAttribute('data-id');
            window.location.href = `/<%= entidad %>/${id}/delete`;
        });
});

    
</script>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>